<html>
<head>
  <title></title>
</head>
<body>
  <h1></h1>
  

<p>#!div class=important
      <em>Please note that using Trac via CGI is the slowest deployment method available. It is slower than [TracModPython mod_python], [TracFastCgi FastCGI] and even [trac:TracOnWindowsIisAjp IIS/AJP] on Windows.</em></p>

<p>CGI script is the entrypoint that web-server calls when a web-request to an application is made. To generate the <code>trac.cgi</code> script run:</p>

<pre><code>trac-admin /path/to/env deploy /path/to/www/trac
</code></pre>

<p><code>trac.cgi</code> will be in the <code>cgi-bin</code> folder inside the given path. Make sure it is executable by your web server. This command also copies <code>static resource</code> files to a <code>htdocs</code> directory of a given destination.</p>

<h1 id="apache-web-server-configuration:9498089bbc48f0a218b9d161943d9637">Apache web-server configuration</h1>

<p>In <a href="http://httpd.apache.org/">Apache</a> there are two ways to run Trac as CGI:</p>

<ol>
<li>Use a <code>ScriptAlias</code> directive that maps an URL to the <code>trac.cgi</code> script (recommended)</li>
<li>Copy the <code>trac.cgi</code> file into the directory for CGI executables used by your web server (commonly named <code>cgi-bin</code>). You can also create a symbolic link, but in that case make sure that the <code>FollowSymLinks</code> option is enabled for the <code>cgi-bin</code> directory.</li>
</ol>

<p>To make Trac available at <code>http://yourhost.example.org/trac</code> add <code>ScriptAlias</code> directive to Apache configuration file, changing <code>trac.cgi</code> path to match your installation:</p>

<pre><code>ScriptAlias /trac /path/to/www/trac/cgi-bin/trac.cgi
</code></pre>

<p><em>Note that this directive requires enabled <code>mod_alias</code> module.</em></p>

<p>If you&rsquo;re using Trac with a single project you need to set its location using the <code>TRAC_ENV</code> environment variable:</p>

<pre><code>&lt;Location &quot;/trac&quot;&gt;
  SetEnv TRAC_ENV &quot;/path/to/projectenv&quot;
&lt;/Location&gt;
</code></pre>

<p>Or to use multiple projects you can specify their common parent directory using the <code>TRAC_ENV_PARENT_DIR</code> variable:</p>

<pre><code>&lt;Location &quot;/trac&quot;&gt;
  SetEnv TRAC_ENV_PARENT_DIR &quot;/path/to/project/parent/dir&quot;
&lt;/Location&gt;
</code></pre>

<p><em>Note that the <code>SetEnv</code> directive requires enabled <code>mod_env</code> module. It is also possible to set TRAC_ENV in trac.cgi. Just add the following code between &ldquo;try:&rdquo; and &ldquo;from trac.web &hellip;&rdquo;:</em></p>

<pre><code>    import os
    os.environ['TRAC_ENV'] = &quot;/path/to/projectenv&quot;
</code></pre>

<p>_ Or for TRAC_ENV_PARENT_DIR: _</p>

<pre><code>    import os
    os.environ['TRAC_ENV_PARENT_DIR'] = &quot;/path/to/project/parent/dir&quot;
</code></pre>

<p>If you are using the <a href="http://httpd.apache.org/docs/suexec.html">Apache suEXEC</a> feature please see [<a href="http://trac.edgewall.org/wiki/ApacheSuexec">http://trac.edgewall.org/wiki/ApacheSuexec</a>].</p>

<p>On some systems, you <em>may</em> need to edit the shebang line in the <code>trac.cgi</code> file to point to your real Python installation path. On a Windows system you may need to configure Windows to know how to execute a .cgi file (Explorer -&gt; Tools -&gt; Folder Options -&gt; File Types -&gt; CGI).</p>

<h1 id="mapping-static-resources:9498089bbc48f0a218b9d161943d9637">Mapping Static Resources</h1>

<p>Out of the box, Trac will pass static resources such as style sheets or images through itself. For a CGI setup this is <em>highly undesirable</em>, because this way CGI script is invoked for documents that could be much more efficiently served directly by web server.</p>

<p>Web servers such as <a href="http://httpd.apache.org/">Apache</a> allow you to create “Aliases” to resources, giving them a virtual URL that doesn&rsquo;t necessarily reflect the layout of the servers file system. We already used this capability by defining a <code>ScriptAlias</code> for the CGI script. We also can map requests for static resources directly to the directory on the file system, avoiding processing these requests by CGI script.</p>

<p>There are two primary URL paths for static resources - <code>/chrome/common</code> and <code>/chrome/site</code>. Plugins can add their own resources usually accessible by <code>/chrome/plugin</code> path, so its important to override only known paths and not try to make universal <code>/chrome</code> alias for everything.</p>

<p>Add the following snippet to Apache configuration <em>before</em> the <code>ScriptAlias</code> for the CGI script, changing paths to match your deployment:</p>

<pre><code>Alias /trac/chrome/common /path/to/trac/htdocs/common
Alias /trac/chrome/site /path/to/trac/htdocs/site
&lt;Directory &quot;/path/to/www/trac/htdocs&quot;&gt;
  Order allow,deny
  Allow from all
&lt;/Directory&gt;
</code></pre>

<p>If using mod_python, you might want to add this too (otherwise, the alias will be ignored):</p>

<pre><code>&lt;Location &quot;/trac/chrome/common/&quot;&gt;
  SetHandler None
&lt;/Location&gt;
</code></pre>

<p>Note that we mapped <code>/trac</code> part of the URL to the <code>trac.cgi</code> script, and the path <code>/chrome/common</code> is the path you have to append to that location to intercept requests to the static resources.</p>

<p>For example, if Trac is mapped to <code>/cgi-bin/trac.cgi</code> on your server, the URL of the Alias should be <code>/cgi-bin/trac.cgi/chrome/common</code>.</p>

<p>Similarly, if you have static resources in a project&rsquo;s htdocs directory (which is referenced by /chrome/site URL in themes), you can configure Apache to serve those resources (again, put this <em>before</em> the <code>ScriptAlias</code> for the CGI script, and adjust names and locations to match your installation):</p>

<pre><code>Alias /trac/chrome/site /path/to/projectenv/htdocs
&lt;Directory &quot;/path/to/projectenv/htdocs&quot;&gt;
  Order allow,deny
  Allow from all
&lt;/Directory&gt;
</code></pre>

<p>Alternatively to hacking <code>/trac/chrome/site</code>, you can directly specify path to static resources using <code>htdocs_location</code> configuration option in [wiki:TracIni trac.ini]:</p>

<pre><code>[trac]
htdocs_location = http://yourhost.example.org/trac-htdocs
</code></pre>

<p>Trac will then use this URL when embedding static resources into HTML pages. Of course, you still need to make the Trac <code>htdocs</code> directory available through the web server at the specified URL, for example by copying (or linking) the directory into the document root of the web server:</p>

<pre><code>$ ln -s /path/to/www/trac/htdocs /var/www/yourhost.example.org/trac-htdocs
</code></pre>

<p>Note that in order to get this <code>htdocs</code> directory, you need first to extract the relevant Trac resources using the <code>deploy</code> command of TracAdmin:
[[TracAdminHelp(deploy)]]</p>

<h1 id="adding-authentication:9498089bbc48f0a218b9d161943d9637">Adding Authentication</h1>

<p>The simplest way to enable authentication with Apache is to create a password file. Use the <code>htpasswd</code> program to create the password file:</p>

<pre><code>$ htpasswd -c /somewhere/trac.htpasswd admin
New password: &lt;type password&gt;
Re-type new password: &lt;type password again&gt;
Adding password for user admin
</code></pre>

<p>After the first user, you dont need the &ldquo;-c&rdquo; option anymore:</p>

<pre><code>$ htpasswd /somewhere/trac.htpasswd john
New password: &lt;type password&gt;
Re-type new password: &lt;type password again&gt;
Adding password for user john
</code></pre>

<p><em>See the man page for <code>htpasswd</code> for full documentation.</em></p>

<p>After you&rsquo;ve created the users, you can set their permissions using TracPermissions.</p>

<p>Now, you&rsquo;ll need to enable authentication against the password file in the Apache configuration:</p>

<pre><code>&lt;Location &quot;/trac/login&quot;&gt;
  AuthType Basic
  AuthName &quot;Trac&quot;
  AuthUserFile /somewhere/trac.htpasswd
  Require valid-user
&lt;/Location&gt;
</code></pre>

<p>If you&rsquo;re hosting multiple projects you can use the same password file for all of them:</p>

<pre><code>&lt;LocationMatch &quot;/trac/[^/]+/login&quot;&gt;
  AuthType Basic
  AuthName &quot;Trac&quot;
  AuthUserFile /somewhere/trac.htpasswd
  Require valid-user
&lt;/LocationMatch&gt;
</code></pre>

<p>For better security, it is recommended that you either enable SSL or at least use the “digest” authentication scheme instead of “Basic”. Please read the <a href="http://httpd.apache.org/docs/2.0/">Apache HTTPD documentation</a> to find out more. For example, on a Debian 4.0r1 (etch) system the relevant section  in apache configuration can look like this:</p>

<pre><code>&lt;Location &quot;/trac/login&quot;&gt;
    LoadModule auth_digest_module /usr/lib/apache2/modules/mod_auth_digest.so
    AuthType Digest
    AuthName &quot;trac&quot;
    AuthDigestDomain /trac
    AuthUserFile /somewhere/trac.htpasswd
    Require valid-user
&lt;/Location&gt;
</code></pre>

<p>and you&rsquo;ll have to create your .htpasswd file with htdigest instead of htpasswd as follows:</p>

<pre><code># htdigest /somewhere/trac.htpasswd trac admin
</code></pre>

<p>where the &ldquo;trac&rdquo; parameter above is the same as AuthName above  (&ldquo;Realm&rdquo; in apache-docs).</p>

<hr />

<p>See also:  TracGuide, TracInstall, [wiki:TracModWSGI], TracFastCgi, TracModPython</p>

<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
